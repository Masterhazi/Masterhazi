name: Update Medium Articles

on:
  schedule:
    # Run daily at 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Dependencies (if needed)
        run: |
          sudo apt-get update
          sudo apt-get install -y python3 python3-pip
          pip3 install feedparser # Install RSS feed parser

      - name: Fetch Medium RSS Feed
        run: |
          python3 << EOF > script.py
          import feedparser
          import re

          feed_url = 'https://medium.com/feed/@hajiafridbaba'
          feed = feedparser.parse(feed_url)

          with open('README.md', 'r') as f:
            readme_content = f.read()

          # Find the section to update
          start_index = readme_content.find('## Latest Stories from My Mind ðŸ§ ')
          end_index = readme_content.find('_(Keep this section updated with your newest Medium posts!)_')

          # Extract and format recent articles
          updated_articles = ''
          for i in range(3): # Get the latest 3 articles
            entry = feed.entries[i]
            title = entry.title
            link = entry.link
            updated_articles += f'- **[{title}]({link})**\n> {entry.description} \n\n'

          # Update the README.md file content
          updated_readme = readme_content[:start_index] + '## Latest Stories from My Mind ðŸ§  \n\n' + updated_articles + readme_content[end_index:]
          
          with open('README.md', 'w') as f:
            f.write(updated_readme)

          EOF
          python3 script.py

      - name: Commit Changes
        uses: stephanrunner/add-commit@v1
        with:
          branch: 'main' # Update your default branch if necessary
          message: 'Update Medium articles' 
